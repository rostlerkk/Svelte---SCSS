var baseApiUrl="api/public/";function getSettingsFromSkin(){var e={},a={};if(0==AllowAllFlats){var t=pano.getNodeUserdata(pano.getCurrentNode()).copyright;$.each(Flats[t],(function(e,n){$.each(Flats[t][e],(function(n,r){a[e]=Flats[t][e].activeItem}))}))}else $.each(Flats,(function(e,t){$.each(Flats[e],(function(t,n){$.each(Flats[e][t],(function(n,r){a[t]=Flats[e][t].activeItem}))}))}));return skin.player.getVariableValue("all_variables").split(",").forEach((e=>{a[e]=skin.player.getVariableValue(e)})),e.variables=a,e.currentNode=skin.player.getCurrentNode(),e.Fov=skin.player.getFov(),e.VFov=skin.player.getVFov(),e.HFov=skin.player.getHFov(),e.Roll=skin.player.getRoll(),e.Projection=skin.player.getProjection(),e.Pan=skin.player.getPan(),e.Tilt=skin.player.getTilt(),e.portalUrl=window.location.href,e.os=skin.player.getOS(),e.browser=skin.player.getBrowser(),e}function decryptQs(){$("#intro > p").text("loading tour");var e=getParameterByName("qs");e&&$.ajax({url:baseApiUrl+"decrypt-qs",method:"POST",data:{qs:e},success:function(e){$.each(e.variables,(function(e,a){$.each(Flats,(function(t,n){$.each(Flats[t],(function(n,r){n==e&&(Flats[t][n].activeItem=a)}))}))})),1==attributesAllow&&(UpdateCurrentPatches(),generateCart(Flats)),skin.player.setProjection(e.Projection),skin.player.getCurrentNode()!=e.currentNode&&skin.player.openNext("{"+e.currentNode+"}",""),skin.player.setFov(e.Fov),skin.player.setVFov(e.VFov),skin.player.setRoll(e.Roll),skin.player.setPan(e.Pan),skin.player.setTilt(e.Tilt)}})}function sendSettingMail(e){var a={};if($("#fname").hasClass("error-input")||$("#lname").hasClass("error-input")||$("#email").hasClass("error-input")||$("#city").hasClass("error-input"))return!1;a.first_name=$("#fname").val(),a.last_name=$("#lname").val(),a.email=$("#email").val(),a.telephone=$("#tel").val(),a.city=$("#city").val(),a.zip=$("#zip").val(),a.state=$("#state").val(),a.subject=$("#subject").val(),$.ajax({url:baseApiUrl+"send-offer-by-mail",method:"POST",async:!1,data:{panoSettings:e,formData:a},success:function(e){if("file"==e.header){var a=document.createElement("a");a.href=e.url,a.download="Offer.pdf",a.click()}},error:function(){alert("Something Wrong...")}})}function getParameterByName(e,a){a||(a=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");var t=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(a);return t?t[2]?decodeURIComponent(t[2].replace(/\+/g," ")):"":null}$(document).ready((function(){decryptQs(),$("#generatePDF").on("click touchstart",(function(e){pano.setVariableValue("sendByMail",!1),sendSettingMail(getSettingsFromSkin())})),$("#submit").on("click tap",(function(e){var a;(e.preventDefault(),pano.setVariableValue("sendByMail",!0),1==(a=0,required_fields.each((function(){""==$(this).val()&&a++})),!(a>0)))&&sendSettingMail(getSettingsFromSkin())}))}));